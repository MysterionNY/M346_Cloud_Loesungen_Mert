# KN06 Skalierung

## Was ist Reverse Proxy?
Ein Reverse Proxy ist ein Server, der Anfragen von Clients entgegennimmt und intern an einen oder mehrere Backend-Server weiterleitet.
In meinem Fall nimmt Nginx die HTTP-Anfragen auf Port 80 entgegen und leitet sie an die eigentliche Anwendung weiter, die intern auf Port 5000/5001 läuft.

Vorteile:

Versteckt interne Ports/Instanzen (Sicherheit, weniger direkte Angriffsfläche)

Zentrale Stelle für SSL/TLS, Caching, Logging

Load Balancing möglich (Verteilung auf mehrere Backends)

Der Client sieht nur den Reverse Proxy (z.B. http://meine-ip/), nicht aber, dass intern z.B. localhost:5001 verwendet wird.

![Swagger Übersicht][swagger]

![Products Ausgabe][products_ausgabe]

![Cluster Products][cluster_products]

## Welche Teile im Cloud-Init machen keinen Sinn in Produktion?
In einer produktiven Umgebung würden folgende Teile des Cloud-Init-Skripts angepasst oder entfernt:

Hardcodierte Zugangsdaten:
Benutzername, Passwort und Cluster-URL für MongoDB sind im Klartext im Skript.
→ In Produktion gehören solche Secrets in AWS Secrets Manager oder Parameter Store.

„Allow access from anywhere“ (0.0.0.0/0) für MongoDB:
Das ist nur für Tests ok. Produktiv würde man nur bekannte IPs zulassen.

Git-Clone aus öffentlichem Repo und Installationen bei jedem Start:
In Produktion verwendet man ein fertiges AMI oder ein Deployment (z. B. Elastic Beanstalk oder Docker).

Manuelle App-Starts und Sleep-Kommandos:
Statt runcmd-Installationen würde man den Build automatisiert im CI/CD-Prozess ausrollen.

Keine Fehler- oder Health-Checks:
Produktiv würde man Health-Checks und Logging zentral erfassen (z. B. CloudWatch).


## Vertikale Skalierung
Die Vergrösserung eines EBS-Volumes ist im laufenden Betrieb möglich.
Ich habe das Volume über die Konsole von 8 GB auf 20 GB erweitert und auf der Instanz das Dateisystem mit growpart und resize2fs angepasst. Ein Neustart war nicht nötig.

![Instanztyp Vorher][instanz_vorher]

![Instanztyp Nachher][instanz_nachher]

Den Instanztyp konnte ich nur ändern, während die Instanz gestoppt war.
Nach der Änderung auf t2.medium und dem Neustart hatte der Server 2 vCPUs und 4 GB RAM.
→ Vertikale Skalierung erfordert hier einen kurzen Ausfall.

![Speicher Vorher][speicher_vorher]

![Speicher Nachher][speicher_nachher]

## Horizontale Skalierung
Ein AWS Application Load Balancer (ALB) bekommt automatisch einen DNS-Namen, z. B.

KN06-ALB-549542897.us-east-1.elb.amazonaws.com


Dieser Name wird von AWS verwaltet und zeigt immer auf die aktuellen IP-Adressen der Load-Balancer-Nodes.
Der Vorteil: Auch wenn sich die internen IPs ändern, bleibt die DNS-Adresse gleich.

Wenn man möchte, dass die App über eine eigene Domain erreichbar ist (z. B. app.tbz-m346.ch),
muss man im DNS-Management (z. B. bei Route 53 oder externem Anbieter)
einen CNAME-Eintrag anlegen:

Typ	Name	Wert
CNAME	app.tbz-m346.ch	KN06-ALB-549542897.us-east-1.elb.amazonaws.com

Damit wird jede Anfrage an app.tbz-m346.ch automatisch an den AWS-Load-Balancer weitergeleitet.

![Loadbalancer][loadbalancer]

[swagger]: /Images/KN06_Swagger.png
[loadbalancer]: /Images/KN06_Loadbalancer.png
[products_ausgabe]: /Images/KN06_Products_Ausgabe.png
[cluster_products]: /Images/KN06_Cluster_Products.png
[instanz_vorher]: /Images/KN06_Instanztyp_Vorher.png
[instanz_nachher]: /Images/KN06_Instanztyp_Nachher.png
[speicher_vorher]: /Images/KN06_Speicher_Vorher.png
[speicher_nachher]: /Images/KN06_Speicher_Nachher.png
